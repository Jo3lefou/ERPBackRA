{% extends 'base.html.twig' %}

{% block title %}Rime Arodaky {{ title }}{% endblock %}

{% block body %}
	<div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col menu_fixed">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="/" class="site_title"><span><img src="{{ url('homepage') }}build/images/logo.png" height="39px" style="margin-left: 36px"></span></a>
            </div>

            <div class="clearfix"></div>

            {{ include('bloc/bloc-leftnav-profil.html.twig') }}

            <br />

            {{ include('bloc/bloc-leftnav-menu.html.twig') }}
            {{ include('bloc/bloc-leftnav-shortcut.html.twig') }}
            
          </div>
        </div>

        {{ include('bloc/bloc-topnav.html.twig') }}
        


          <!-- page content -->
        <div class="right_col" role="main">
          {% for message in app.flashes('success') %}
              <div class="alert alert-success">
                  {{ message }}
              </div>
          {% endfor %}
          
          {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_SALE_MANAGER') or is_granted('ROLE_PROVIDER') or is_granted('ROLE_SALE') or is_granted('ROLE_PRODUCTION_MANAGER') %}
          <!-- top tiles -->
          {{ render(controller('AppBundle:Base:getStatData', {} )) }}
          <!-- /top tiles -->
          {% endif %}

          <div class="row">
            
            <div class="col-md-12 col-sm-12 col-xs-12">
              <div class="dashboard_graph">

                <div class="row x_title">
                  <div class="col-md-12">
                    <h3>Expedition tracker <small>Select your shop and visualize the production to send...</small></h3>
                  </div>
                </div>
                <div class="x_content">
                  
                  <form class="form-horizontal form-label-left">
                      <h4>Step One : choose your recipient</h4>
                      <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Select recipient</label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input type="hidden" id="localejs" value="{{locale}}"/>
                          <select class="form-control" id="shoprcp" rel="/{{ locale }}/prodtoolbox/ajaxsearchexpedition/1">
                            <option value="" selected></option>
                            {% for shop in shops %}
                              <option value="{{shop.id}}">{{ shop.name }}</option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                      <div class="clearfix"></div>
                      <div class="col-md-12 col-sm-12 col-xs-12">
                        <h5>For the recipient <span class="namercp"></span></h5>
                        <div id="urglist" style="border:1px solid #EFEFEF; padding:15px 20px">
                          <div class="alert alert-info" role="alert"><strong>Hey !</strong> Select a recipient above !</div>
                          
                            
                        </div>
                      </div>

                      <div class="clearfix"></div>
                      <h4 style="margin-top:30px;">Step Two : Would you like to add product ?</h4>
                      <div class="col-md-3 col-sm-3 col-xs-12">
                      </div>
                      <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="">
                          <label>
                            <input class="js-switch" style="display: none;" data-switchery="true" type="checkbox" id="morercp" rel="/{{ locale }}/prodtoolbox/ajaxsearchexpedition/2" ></span> Add more production
                          </label>
                        </div>
                      </div>
                      <div class="clearfix"></div>
                      <div class="col-md-12 col-sm-12 col-xs-12">
                        <h5>More for the recipient <span class="namercp"></span></h5>
                        <div id="seclist" style="border:1px solid #EFEFEF; padding:15px 20px">
                          <div class="alert alert-info" role="alert"><strong>Hey !</strong> First, select a recipient and then activate option adove if you want more...</div>
                        </div>
                      </div>
                  </form>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        </div>
        <!-- /page content -->

        {{ include('bloc/bloc-footer.html.twig') }}
        
      </div>
    </div>

{% endblock %}

{% block footer %}
  <!-- jQuery -->
    <script src="{{ url('homepage') }}vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="{{ url('homepage') }}vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="{{ url('homepage') }}vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="{{ url('homepage') }}vendors/nprogress/nprogress.js"></script>
    <!-- Chart.js -->
    <script src="{{ url('homepage') }}vendors/Chart.js/dist/Chart.min.js"></script>
    <!-- gauge.js -->
    <script src="{{ url('homepage') }}vendors/gauge.js/dist/gauge.min.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="{{ url('homepage') }}vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- iCheck -->
    <script src="{{ url('homepage') }}vendors/iCheck/icheck.min.js"></script>
    <!-- Skycons -->
    <script src="{{ url('homepage') }}vendors/skycons/skycons.js"></script>
    <!-- Flot -->
    <script src="{{ url('homepage') }}vendors/Flot/jquery.flot.js"></script>
    <script src="{{ url('homepage') }}vendors/Flot/jquery.flot.pie.js"></script>
    <script src="{{ url('homepage') }}vendors/Flot/jquery.flot.time.js"></script>
    <script src="{{ url('homepage') }}vendors/Flot/jquery.flot.stack.js"></script>
    <script src="{{ url('homepage') }}vendors/Flot/jquery.flot.resize.js"></script>
    <!-- Flot plugins -->
    <script src="{{ url('homepage') }}vendors/flot.orderbars/js/jquery.flot.orderBars.js"></script>
    <script src="{{ url('homepage') }}vendors/flot-spline/js/jquery.flot.spline.min.js"></script>
    <script src="{{ url('homepage') }}vendors/flot.curvedlines/curvedLines.js"></script>
    <!-- DateJS -->
    <script src="{{ url('homepage') }}vendors/DateJS/build/date.js"></script>
    <!-- JQVMap -->
    <script src="{{ url('homepage') }}vendors/jqvmap/dist/jquery.vmap.js"></script>
    <script src="{{ url('homepage') }}vendors/jqvmap/dist/maps/jquery.vmap.world.js"></script>
    <script src="{{ url('homepage') }}vendors/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
    <!-- Switchery -->
    <script src="{{ url('homepage') }}vendors/switchery/dist/switchery.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="{{ url('homepage') }}vendors/moment/min/moment.min.js"></script>
    <script src="{{ url('homepage') }}vendors/bootstrap-daterangepicker/daterangepicker.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="{{ url('homepage') }}build/js/custom.min.js"></script>
    <script>
      

      $('#shoprcp').on('change', function() {
          var href = $(this).attr('rel');
          var value = $(this).val();
          var locale = $("#localejs").val();
          $('#seclist').html('<div class="alert alert-info" role="alert"><strong>Ok then.</strong> You want more ?</div>');
          //alert(value);
          $('#loading-bar').fadeIn();
          $.ajax( {
            type:"POST",
            url: href,
            dataType: "json",
            data: { value: value, locale:locale },
            success: function( data ) {
              console.log(data);
              if(Object.keys(data).length > 0){
                $('#urglist').html('');
                if(locale == 'fr'){
                  var title = '<h4>Nous avons trouvé '+Object.keys(data).length+' commandes qui peuvent être envoyées...</h4>';
                }else{
                  var title = '<h4>We have found '+Object.keys(data).length+' orders who can be sent...</h4>';
                }
                $('#urglist').append(title);
                $('#urglist').append('<ul class="list-group"></ul>');
              }else{
                $('#urglist').html('');
                if(locale == 'fr'){
                  var title = '<h4>Nous n\'avons trouvé aucune commandes à envoyer...</h4>';
                }else{
                  var title = '<h4>We have not found any order to send...</h4>';
                }
                $('#urglist').append(title);
              }
              $.each(data, function (index, article) {
                  if(locale == 'fr'){
                    var item = '<li class="list-group-item"><div class="col-md-6 col-sm-6 col-xs-12"><h5 style="border-bottom: 1px solid #EFEFEF;padding-bottom: 10px;margin-bottom: 0px;"><strong>Commande '+article.id+' pour '+article.customerName+'</strong></h5><br><strong>Date minimum de livraison : </strong>'+article.minShip+'<br><strong>Date maximum de livraison : </strong>'+article.maxShip+'<br><strong>Date de la commande : </strong>'+article.orderDate+'</div><div class="col-md-6 col-sm-6 col-xs-12"><p style="margin: 0 0 17px;"><a href="/fr/production/single/'+article.idProd+'" class="btn btn-default">Voir cette commande</a></p><p><strong>Nom du modèle : </strong>'+article.modelName+' ('+article.sku+')<br/><strong>Taille : </strong>'+article.sire+'<br><strong>Longueur: </strong>'+article.length+'</p></div><div class="clearfix"></div></li>';
                  }else{
                    var itme = '<li class="list-group-item"><div class="col-md-6 col-sm-6 col-xs-12"><h5 style="border-bottom: 1px solid #EFEFEF;padding-bottom: 10px;margin-bottom: 0px;"><strong>Order '+article.id+' for '+article.customerName+'</strong></h5><br><strong>Minimum date of shipping: </strong>'+article.minShip+'<br><strong>Maximum date of shipping: </strong>'+article.maxShip+'<br><strong>Order Date: </strong>'+article.orderDate+'</div><div class="col-md-6 col-sm-6 col-xs-12"><p style="margin: 0 0 17px;"><a href="/fr/production/single/'+article.idProd+'" class="btn btn-default">See that order</a></p><p><strong>Model name: </strong>'+article.modelName+' ('+article.sku+')<br/><strong>Size: </strong>'+article.sire+'<br><strong>Length: </strong>'+article.length+'</p></div><div class="clearfix"></div></li>';
                  }
                 
                 $('#urglist .list-group').append(item);
              });

              $('#loading-bar').fadeOut();
            },
            complete: function(){
              
            }
          });
      });

      var changeCheckbox = document.querySelector('#morercp');
      changeCheckbox.onchange = function(e) {
        e.preventDefault;
        if($('#shoprcp').val() == ''){
          alert('Please select a shop first.');
        }else{
          $('#loading-bar').fadeIn();
          var href = $(this).attr('rel');
          var locale = $("#localejs").val();
          var shop = $('#shoprcp').val();
          $.ajax( {
            type:"POST",
            url: href,
            dataType: "json",
            data: { value: shop, locale:locale },
            success: function( data ) {
              console.log(data);
              if(Object.keys(data).length > 0){
                $('#seclist').html('');
                if(locale == 'fr'){
                  var title = '<h4>Nous avons trouvé '+Object.keys(data).length+' autres commandes qui peuvent être envoyées aussi...</h4>';
                }else{
                  var title = '<h4>We have found '+Object.keys(data).length+' other orders who can be sent as well...</h4>';
                }
                $('#seclist').append(title);
                $('#seclist').append('<ul class="list-group"></ul>');
              }else{
                $('#seclist').html('');
                if(locale == 'fr'){
                  var title = '<h4>Nous n\'avons trouvé aucune autre commande à envoyer...</h4>';
                }else{
                  var title = '<h4>We have not found any other order to send...</h4>';
                }
                $('#seclist').append(title);
              }
              $.each(data, function (index, article) {
                  if(locale == 'fr'){
                    var item = '<li class="list-group-item"><div class="col-md-6 col-sm-6 col-xs-12"><h5 style="border-bottom: 1px solid #EFEFEF;padding-bottom: 10px;margin-bottom: 0px;"><strong>Commande '+article.id+' pour '+article.customerName+'</strong></h5><br><strong>Date minimum de livraison : </strong>'+article.minShip+'<br><strong>Date maximum de livraison : </strong>'+article.maxShip+'<br><strong>Date de la commande : </strong>'+article.orderDate+'</div><div class="col-md-6 col-sm-6 col-xs-12"><p style="margin: 0 0 17px;"><a href="/fr/production/single/'+article.idProd+'" class="btn btn-default">Voir cette commande</a></p><p><strong>Nom du modèle : </strong>'+article.modelName+' ('+article.sku+')<br/><strong>Taille : </strong>'+article.sire+'<br><strong>Longueur: </strong>'+article.length+'</p></div><div class="clearfix"></div></li>';
                  }else{
                    var itme = '<li class="list-group-item"><div class="col-md-6 col-sm-6 col-xs-12"><h5 style="border-bottom: 1px solid #EFEFEF;padding-bottom: 10px;margin-bottom: 0px;"><strong>Order '+article.id+' for '+article.customerName+'</strong></h5><br><strong>Minimum date of shipping: </strong>'+article.minShip+'<br><strong>Maximum date of shipping: </strong>'+article.maxShip+'<br><strong>Order Date: </strong>'+article.orderDate+'</div><div class="col-md-6 col-sm-6 col-xs-12"><p style="margin: 0 0 17px;"><a href="/fr/production/single/'+article.idProd+'" class="btn btn-default">See that order</a></p><p><strong>Model name: </strong>'+article.modelName+' ('+article.sku+')<br/><strong>Size: </strong>'+article.sire+'<br><strong>Length: </strong>'+article.length+'</p></div><div class="clearfix"></div></li>';
                  }
                 
                 $('#seclist .list-group').append(item);
              });

              $('#loading-bar').fadeOut();
            },
            complete: function(){
              
            }
          });




        }
      };

    </script>
{% endblock %}
